<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SBS Authentic Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --sbs-yellow: #FFD200; --sbs-black: #1A1A1A; --sbs-orange: #FF6600; --red: #ff0000; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Poppins', sans-serif; margin: 0; padding: 15px; 
            background: radial-gradient(circle at center, var(--sbs-yellow) 0%, #e6bc00 100%); 
            background-attachment: fixed; padding-bottom: 50px;
        }

        /* --- HEADER & BAR --- */
        .top-bar { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .logo-container { width: 60px; height: 60px; background: var(--sbs-black); border-radius: 50%; border: 3px solid #fff; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .logo-container img { width: 100%; height: auto; }
        .header-title h1 { font-family: 'Bebas Neue'; font-size: 48px; margin: 0; line-height: 1; text-shadow: 3px 3px 0px #fff; }

        /* --- SEARCH & TABS (RESTORASI CSS YANG HILANG) --- */
        .search-wrapper { position: relative; margin-bottom: 15px; }
        .search-box { width: 100%; padding: 12px 40px; border-radius: 25px; border: 2px solid var(--sbs-black); font-family: 'Poppins'; font-weight: bold; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 18px; height: 18px; }
        .clear-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); border: none; background: none; font-size: 18px; cursor: pointer; display: none; }

        .tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; margin-bottom: 20px; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab-btn { padding: 8px 20px; border-radius: 20px; border: 2px solid var(--sbs-black); background: #fff; font-weight: 900; white-space: nowrap; cursor: pointer; font-size: 13px; text-transform: uppercase; }
        .tab-btn.active { background: var(--sbs-black); color: var(--sbs-yellow); }

        /* --- MENU CARDS (RESTORASI) --- */
        .content { display: none; grid-template-columns: 1fr 1fr; gap: 15px; }
        .content.active { display: grid; }
        .menu-card { background: #fff; border-radius: 20px; overflow: hidden; position: relative; border: 3px solid var(--sbs-black); box-shadow: 6px 6px 0px rgba(0,0,0,0.1); }
        .card-img-box img { width: 100%; aspect-ratio: 1/1; object-fit: cover; display: block; }
        .add-badge { position: absolute; bottom: 10px; right: 10px; background: var(--sbs-orange); width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--sbs-black); display: flex; align-items: center; justify-content: center; }
        .add-badge svg { width: 20px; height: 20px; fill: #fff; }
        .card-hidden { display: none !important; }

        /* --- FLOATING UI (FIXED & PROPOSIONAL) --- */
        .floating-container { position: fixed; top: 20px; right: 15px; z-index: 2100; display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
        .fab-btn { width: 48px; height: 48px; border-radius: 50%; border: 2px solid var(--sbs-black); background: #fff; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer; position: relative; transition: 0.2s; }
        .fab-btn:active { transform: scale(0.9); }
        .fab-btn svg { width: 22px; height: 22px; fill: var(--sbs-black); }
        
        .fab-cart { background: var(--sbs-yellow); }
        .fab-cart.has-items { background: var(--sbs-orange); border-color: #fff; animation: bounce 0.3s; }
        .fab-cart.has-items svg { fill: #fff; }
        
        .fab-history { display: none; }
        .fab-history.active-order { display: flex; background: #2ecc71; border-color: #fff; }
        .fab-history.active-order svg { fill: #fff; }

        .fab-badge { position: absolute; top: -5px; right: -5px; background: var(--red) !important; color: #fff !important; font-size: 10px; font-weight: 900; min-width: 18px; height: 18px; border-radius: 50%; border: 2px solid #fff; display: flex; align-items: center; justify-content: center; opacity: 0; transform: scale(0); transition: 0.2s; }
        .fab-badge.show { opacity: 1; transform: scale(1); }

        /* --- MODAL & HISTORY STYLE --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(3px); }
        .modal-content { background: #fff; width: 90%; max-width: 400px; border-radius: 25px; padding: 25px; border: 4px solid var(--sbs-black); position: relative; max-height: 85vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 24px; font-weight: 900; cursor: pointer; }
        .modal-header { font-family: 'Bebas Neue'; font-size: 32px; border-bottom: 2px solid #eee; margin-bottom: 15px; }
        
        .history-section-title { font-size: 13px; font-weight: 900; margin: 15px 0 10px 0; border-bottom: 2px solid var(--sbs-yellow); display: inline-block; }
        .history-card { background: #f9f9f9; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #ddd; }
        .history-header { display: flex; justify-content: space-between; font-weight: 900; font-size: 12px; margin-bottom: 5px; }
        .history-status { font-weight: 900; font-size: 14px; text-transform: uppercase; }
        .history-items { font-size: 11px; color: #666; margin-top: 4px; }
        .btn-clear-history { background: #f0f0f0; border: none; width: 100%; padding: 10px; border-radius: 10px; font-weight: bold; color: #888; cursor: pointer; margin-top: 10px; font-size: 11px; }

        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #ddd; }
        .input-group { margin-top: 15px; }
        .input-group label { display: block; font-size: 11px; font-weight: 900; margin-bottom: 5px; }
        .input-group input, .input-group select { width: 100%; padding: 10px; border-radius: 10px; border: 2px solid #ddd; font-family: 'Poppins'; }
        .btn-order { background: var(--sbs-black); color: var(--sbs-yellow); width: 100%; padding: 15px; border-radius: 15px; border: none; font-weight: 900; font-size: 16px; margin-top: 20px; cursor: pointer; }

        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
    </style>
</head>
<body>

<div class="floating-container">
    <div id="fab-history" class="fab-btn fab-history" onclick="openHistory()">
        <svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.53.85-1.07-3.63-2.16V8h-1.5z"/></svg>
        <div id="badge-history" class="fab-badge">0</div>
    </div>
    <div id="fab-cart" class="fab-btn fab-cart" onclick="openCart()">
        <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h11v-2H7l1.1-2h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
        <div id="badge-cart" class="fab-badge">0</div>
    </div>
</div>

<div class="top-bar">
    <div class="logo-container"><img src="img/sbslogo.jpg" alt="Logo"></div>
    <div class="header-title"><h1>OUR MENU</h1></div>
</div>

<div class="search-wrapper">
    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
    <input type="text" id="menuSearch" class="search-box" placeholder="Cari menu..." autocomplete="off">
    <button id="clearSearch" class="clear-btn" onclick="clearSearchInput()">âœ•</button>
</div>

<div class="tabs" id="menuTabs">
    <button class="tab-btn active" onclick="openT(event, 'makan')">Makan</button>
    <button class="tab-btn" onclick="openT(event, 'cemil')">Cemilan</button>
    <button class="tab-btn" onclick="openT(event, 'black')">Black</button>
    <button class="tab-btn" onclick="openT(event, 'white')">White</button>
    <button class="tab-btn" onclick="openT(event, 'comfy')">Comfy</button>
    <button class="tab-btn" onclick="openT(event, 'refresh')">Fresh</button>
    <button class="tab-btn" onclick="openT(event, 'alcs')">Alcs</button>
</div>

<div id="swipe-area">
    <div id="no-results" style="display:none; text-align:center; opacity:0.5; margin-top:50px; font-weight:bold;">MENU TIDAK DITEMUKAN</div>

    <div id="makan" class="content active">
        <div class="menu-card" onclick="addToCart('Kalter', 20000)" data-tags="nasi tahu telor kalter">
            <div class="card-img-box"><img src="img/kalter.webp" alt="Kalter"></div>
            <div class="add-badge"><svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></div>
        </div>
        <div class="menu-card" onclick="addToCart('Obama', 25000)" data-tags="nasi ayam obama">
            <div class="card-img-box"><img src="img/obama.webp" alt="Obama"></div>
            <div class="add-badge"><svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></div>
        </div>
    </div>
    
    </div>

<div id="cart-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeCart()">&times;</span>
        <div class="modal-header">KERANJANG</div>
        <div id="cart-items-container"></div>
        <div style="display:flex; justify-content:space-between; font-weight:900; margin-top:20px; font-size:18px; color:var(--sbs-orange)">
            <span>TOTAL</span>
            <span id="modal-total">Rp 0</span>
        </div>
        <div class="input-group"><label>NO. MEJA</label><input type="number" id="table-number" placeholder="Contoh: 5"></div>
        <div class="input-group"><label>NAMA</label><input type="text" id="customer-real-name" placeholder="Nama Kakak"></div>
        <div class="input-group"><label>METODE BAYAR</label>
            <select id="payment-method">
                <option value="tunai">Tunai di Kasir</option>
                <option value="qris">QRIS (Bayar Sekarang)</option>
            </select>
        </div>
        <button class="btn-order" onclick="submitOrder()">PESAN SEKARANG</button>
    </div>
</div>

<div id="history-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeHistory()">&times;</span>
        <div class="modal-header">RIWAYAT</div>
        <div id="history-container"></div>
        <button class="btn-clear-history" onclick="manualClearHistory()">BERSIHKAN SEMUA RIWAYAT</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    // --- FIREBASE CONFIG (KAKAK SESUAIKAN JIKA BERBEDA) ---
    const firebaseConfig = {
        apiKey: "AIzaSyBSp5184dVTy-EER2qOfxeEA9KQOCMFpKo",
        authDomain: "sbs-menu-d1611.firebaseapp.com",
        databaseURL: "https://sbs-menu-d1611-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sbs-menu-d1611",
        storageBucket: "sbs-menu-d1611.firebasestorage.app",
        messagingSenderId: "530098727952",
        appId: "1:530098727952:web:1bb3072d93be9564fbee95"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let cart = [];
    const AUTO_CLEAR_TIME = 6 * 60 * 60 * 1000;

    function openCart() {
        renderCart();
        document.getElementById('cart-modal').style.display = 'flex';
    }

    function closeCart() { document.getElementById('cart-modal').style.display = 'none'; }

    function addToCart(name, price) {
        const item = cart.find(i => i.name === name);
        if(item) item.qty++; else cart.push({name, price, qty:1});
        updateCartUI();
        if(navigator.vibrate) navigator.vibrate(40);
    }

    function updateCartUI() {
        let count = cart.reduce((a, b) => a + b.qty, 0);
        const badge = document.getElementById('badge-cart');
        const fab = document.getElementById('fab-cart');
        if(count > 0) {
            badge.innerText = count;
            badge.classList.add('show');
            fab.classList.add('has-items');
        } else {
            badge.classList.remove('show');
            fab.classList.remove('has-items');
        }
    }

    function renderCart() {
        const container = document.getElementById('cart-items-container');
        container.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            total += item.price * item.qty;
            container.innerHTML += `
                <div class="cart-item">
                    <span>${item.qty}x ${item.name}</span>
                    <span style="font-weight:bold">Rp ${(item.price * item.qty).toLocaleString()}</span>
                </div>`;
        });
        document.getElementById('modal-total').innerText = 'Rp ' + total.toLocaleString();
    }

    function openHistory() {
        trackOrders();
        document.getElementById('history-modal').style.display = 'flex';
    }

    function closeHistory() { document.getElementById('history-modal').style.display = 'none'; }

    function trackOrders() {
        let history = JSON.parse(localStorage.getItem('sbs_order_history')) || [];
        const fab = document.getElementById('fab-history');
        const badge = document.getElementById('badge-history');
        const container = document.getElementById('history-container');
        
        if(history.length === 0) { fab.style.display = 'none'; return; }
        fab.style.display = 'flex';

        container.innerHTML = `<div id="list-active"></div><div id="list-past"></div>`;
        const listA = document.getElementById('list-active');
        const listP = document.getElementById('list-past');
        let activeCount = 0;
        const now = Date.now();

        history.forEach(id => {
            db.ref('orders/' + id).on('value', snap => {
                const o = snap.val();
                if(!o) return;
                
                // Auto Clear 6 jam
                if(['completed','rejected'].includes(o.status)){
                    if(now - new Date(o.completedAt || o.timestamp).getTime() > AUTO_CLEAR_TIME) return;
                }

                let isActive = !['completed', 'rejected'].includes(o.status);
                if(isActive) activeCount++;

                const html = `
                    <div class="history-card">
                        <div class="history-header"><span>MEJA ${o.tableNumber}</span><span>${o.paymentMethod.toUpperCase()}</span></div>
                        <div class="history-status" style="color:${isActive?'#3498db':'#2ecc71'}">${o.status}</div>
                        <div class="history-items">${o.items.map(i=>i.name).join(', ')}</div>
                    </div>`;
                
                if(isActive) listA.innerHTML += `<div class="history-section-title" style="color:var(--sbs-orange)">AKTIF</div>` + html;
                else listP.innerHTML += `<div class="history-section-title" style="color:#888">SELESAI</div>` + html;

                badge.innerText = activeCount;
                badge.className = activeCount > 0 ? 'fab-badge show' : 'fab-badge';
                fab.className = activeCount > 0 ? 'fab-btn fab-history active-order' : 'fab-btn fab-history';
            });
        });
    }

    function manualClearHistory() {
        if(confirm("Hapus semua riwayat?")) {
            localStorage.removeItem('sbs_order_history');
            location.reload();
        }
    }

    function submitOrder() {
        const table = document.getElementById('table-number').value;
        const name = document.getElementById('customer-real-name').value;
        if(!table || !name) return alert("Isi Nama & Meja!");

        const orderData = {
            tableNumber: table,
            customerName: name,
            items: cart,
            status: 'new',
            timestamp: new Date().toISOString(),
            paymentMethod: document.getElementById('payment-method').value
        };

        const ref = db.ref('orders').push();
        ref.set(orderData).then(() => {
            let h = JSON.parse(localStorage.getItem('sbs_order_history')) || [];
            h.push(ref.key);
            localStorage.setItem('sbs_order_history', JSON.stringify(h));
            alert("Pesanan Terkirim!");
            cart = []; updateCartUI(); closeCart(); trackOrders();
        });
    }

    // --- TAB LOGIC ---
    function openT(e, n) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(n).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    trackOrders();
</script>
</body>
</html>
