<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBS Authentic Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@700;900&family=Poppins:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        /* --- STYLE CSS --- */
        :root { --sbs-yellow: #FFD200; --sbs-black: #1A1A1A; --sbs-orange: #FF6600; --sbs-dark-yellow: #FFB800; }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 15px; color: var(--sbs-black); background: repeating-linear-gradient(45deg, rgba(0,0,0,0.03) 0px, rgba(0,0,0,0.03) 1px, transparent 1px, transparent 4px), radial-gradient(circle at center, var(--sbs-yellow) 0%, #e6bc00 100%); background-attachment: fixed; overscroll-behavior-y: contain; padding-bottom: 120px; }
        .top-bar { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .logo-container { width: 70px; height: 70px; background: var(--sbs-black); border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0; }
        .logo-container img { width: 100%; height: auto; }
        .header-title h1 { font-family: 'Bebas Neue', cursive; font-size: 55px; margin: 0; line-height: 0.8; letter-spacing: -1px; transform: skew(-5deg); text-shadow: 4px 4px 0px #fff; }

        /* Search & Tabs */
        .search-wrapper { position: relative; margin-bottom: 20px; z-index: 101; }
        .search-box { width: 100%; box-sizing: border-box; background: #fff; border: 3px solid var(--sbs-black); border-radius: 50px; padding: 12px 20px 12px 45px; font-family: 'Montserrat', sans-serif; font-weight: 700; text-transform: uppercase; outline: none; box-shadow: 4px 4px 0px rgba(0,0,0,0.1); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 18px; opacity: 0.6; }
        .clear-btn { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: #ddd; border: none; width: 20px; height: 20px; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; font-size: 12px;}
        .tabs { display: flex; overflow-x: auto; gap: 10px; padding: 12px; margin-bottom: 25px; position: sticky; top: 10px; z-index: 100; background: var(--sbs-dark-yellow); border: 3px solid var(--sbs-black); border-radius: 50px; box-shadow: 6px 6px 0px rgba(0,0,0,0.1); scrollbar-width: none; }
        .tabs.hidden-by-search { display: none; }
        .tab-btn { background: #fff; border: 2px solid var(--sbs-black); padding: 8px 20px; border-radius: 50px; font-family: 'Montserrat', sans-serif; font-size: 11px; text-transform: uppercase; white-space: nowrap; cursor: pointer; box-shadow: 3px 3px 0px rgba(0,0,0,0.2); transition: 0.1s; }
        .tab-btn.active { background: var(--sbs-black); color: #fff; transform: translate(2px, 2px); box-shadow: none; }

        /* Content & Cards */
        .content { display: none; grid-template-columns: 1fr; gap: 30px; }
        .content.active { display: grid; animation: fadeIn 0.4s ease-out; }
        .search-mode-active .content { display: grid !important; animation: none; }
        .card-hidden, .section-hidden { display: none !important; }
        
        .menu-card { background: #fff; border: 3px solid var(--sbs-black); border-radius: 25px; overflow: hidden; box-shadow: 8px 8px 0px var(--sbs-black); position: relative; display: flex; flex-direction: column; cursor: pointer; transition: transform 0.1s; }
        .menu-card:active { transform: scale(0.97); border-color: var(--sbs-orange); }
        .card-img-box { width: 100%; height: auto; aspect-ratio: 1 / 1; position: relative; background: #eee; border-bottom: 3px solid var(--sbs-black); }
        .card-img-box img { width: 100%; height: 100%; object-fit: cover; }
        .best-rec { border-color: var(--sbs-orange); box-shadow: 8px 8px 0px var(--sbs-orange); }

        /* MODIFIKASI CARD INFO (Solusi UX) */
        .card-info { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .card-title { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 16px; text-transform: uppercase; line-height: 1.1; margin-bottom: 2px; }
        
        /* Tombol Harga & Add (+) */
        .price-btn { 
            background: var(--sbs-black); color: #fff; 
            padding: 5px 12px; border-radius: 20px; 
            font-size: 13px; font-weight: 700; 
            display: flex; align-items: center; gap: 5px;
            transition: 0.2s; box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }
        .price-btn span.plus { color: var(--sbs-yellow); font-size: 16px; font-weight: 900; }
        .menu-card:active .price-btn { background: var(--sbs-orange); transform: translateY(2px); box-shadow: none; }

        /* HAPUS GAMBAR KERANJANG DI FOTO (Request 1) */
        .add-badge { display: none !important; }
        
        /* ALCS Style */
        .alcs-card { background: #fff; border: 3px solid var(--sbs-black); box-shadow: 8px 8px 0px var(--sbs-black); border-radius: 20px; padding: 20px; margin-bottom: 0; position: relative; }
        .alcs-brand { font-family: 'Montserrat', sans-serif; font-size: 26px; text-transform: uppercase; font-weight: 900; border-bottom: 3px solid #eee; padding-bottom: 8px; margin-bottom: 15px;}
        .alcs-row { display: flex; justify-content: space-between; font-size: 16px; border-bottom: 1px dashed #ddd; padding: 10px 0; cursor: pointer; align-items: center; }
        .alcs-row:active { background: #f0f0f0; }
        .alcs-variant { font-weight: 600; color: #444; }
        .alcs-price-tag { font-family: 'Montserrat', sans-serif; font-weight: 800; background: #eee; padding: 4px 8px; border-radius: 8px; font-size: 12px; }

        /* --- UI FLOATING BUTTONS (REVISI POSISI - Request 2) --- */
        .floating-container {
            position: fixed; 
            bottom: 30px; /* Jarak dari bawah diperbesar */
            right: 25px;  /* Jarak dari kanan diperbesar (tidak mepet) */
            z-index: 200; 
            display: flex; 
            flex-direction: column-reverse; /* Cart paling bawah (utama) */
            gap: 15px; 
            align-items: center;
        }

        .fab-btn {
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer; position: relative;
            transition: transform 0.1s;
            border: 3px solid var(--sbs-black);
        }
        .fab-btn:active { transform: scale(0.90); }

        /* Cart Button (Besar) */
        .fab-cart { 
            width: 60px; height: 60px; 
            background: var(--sbs-yellow);
        }
        .fab-cart.has-items { background: var(--sbs-orange); border-color: #fff; animation: bounce 0.3s; }
        .fab-cart svg { width: 28px; height: 28px; fill: var(--sbs-black); }
        .fab-cart.has-items svg { fill: #fff; }

        /* History Button (Kecil) */
        .fab-history { 
            width: 45px; height: 45px; 
            background: #fff; 
            display: none; 
        }
        .fab-history svg { width: 22px; height: 22px; fill: #555; }
        .fab-history.active-order { background: #2ecc71; border-color: #fff; }
        .fab-history.active-order svg { fill: #fff; }

        .fab-badge {
            position: absolute; top: -2px; right: -2px;
            background-color: red; color: #fff;
            font-size: 11px; font-weight: 900;
            min-width: 20px; height: 20px; padding: 2px;
            border-radius: 50%; border: 2px solid #fff;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transform: scale(0); transition: 0.2s;
        }
        .fab-badge.show { opacity: 1; transform: scale(1); }

        @keyframes bounce { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.1);} }

        /* --- MODAL --- */
        body.noscroll { overflow: hidden; }
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); backdrop-filter: blur(4px); align-items: center; justify-content: center; }
        .modal-content { background-color: #fff; width: 90%; max-width: 400px; border-radius: 20px; padding: 25px; border: 4px solid var(--sbs-black); max-height: 85vh; overflow-y: auto; position: relative; }

        .cart-item { margin-bottom: 15px; border-bottom: 1px dashed #ddd; padding-bottom: 10px; }
        .item-main { display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; }
        .item-note-input { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 8px; margin-top: 8px; font-size: 12px; font-family: 'Poppins'; outline: none; box-sizing: border-box; }
        .cart-actions button { background: #ddd; border: none; padding: 2px 8px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-left: 5px;}
        .total-row { display: flex; justify-content: space-between; margin-top: 20px; font-weight: bold; font-size: 18px; border-top: 2px solid var(--sbs-black); padding-top: 10px; }
        
        /* Payment Options */
        .input-group { margin-top: 15px; }
        .input-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #666; }
        .input-group input { width: 100%; padding: 10px; border: 2px solid var(--sbs-black); border-radius: 10px; box-sizing: border-box; font-family: 'Poppins'; font-size: 14px; }
        .payment-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .p-option input { display: none; }
        .p-label { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px; border: 2px solid var(--sbs-black); border-radius: 10px; font-weight: bold; font-size: 12px; color: #666; cursor: pointer; background: #fff; transition: 0.2s; }
        .p-label span { font-size: 18px; }
        .p-option input:checked + .p-label { border-color: var(--sbs-orange); background-color: #fff8f0; color: var(--sbs-orange); box-shadow: 0 4px 10px rgba(255, 102, 0, 0.2); }
        
        .btn-order { background: var(--sbs-orange); color: #fff; border: 3px solid var(--sbs-black); width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 20px; cursor: pointer; font-size: 16px; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; font-weight: bold; }
        .btn-close-final { background: var(--sbs-black); color: #fff; padding: 12px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; width: 100%; }

        /* --- HISTORY DETAIL (REVISI - Request 3) --- */
        .history-card { border: 1px solid #ddd; border-radius: 12px; padding: 15px; margin-bottom: 15px; background: #fcfcfc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .h-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 8px; }
        .h-id { font-size: 12px; color: #888; font-family: monospace; }
        .h-status { font-size: 11px; font-weight: 900; padding: 3px 8px; border-radius: 4px; text-transform: uppercase; }
        
        /* List Item Detail */
        .h-item { display: flex; justify-content: space-between; font-size: 13px; color: #444; margin-bottom: 4px; }
        .h-item-name { font-weight: 500; }
        .h-item-price { font-family: 'Montserrat', sans-serif; font-size: 12px; color: #666; }
        
        .h-total { border-top: 1px dashed #ccc; margin-top: 8px; padding-top: 8px; display: flex; justify-content: space-between; font-size: 14px; font-weight: 900; color: var(--sbs-black); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="floating-container">
    <div id="fab-cart" class="fab-btn fab-cart" onclick="openCart()">
        <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h11v-2H7l1.1-2h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
        <div id="badge-cart" class="fab-badge">0</div>
    </div>

    <div id="fab-history" class="fab-btn fab-history" onclick="openHistory()">
        <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        <div id="badge-history" class="fab-badge">0</div>
    </div>
</div>

<div class="top-bar">
    <div class="logo-container"><img src="img/sbslogo.jpg" alt="SBS Logo"></div>
    <div class="header-title"><h1>OUR MENU</h1></div>
</div>

<div class="search-wrapper">
    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
    <input type="text" id="menuSearch" class="search-box" placeholder="Cari menu..." autocomplete="off">
    <button id="clearSearch" class="clear-btn" onclick="clearSearchInput()">‚úï</button>
</div>

<div class="tabs" id="menuTabs">
    <button class="tab-btn active" onclick="openT(event, 'makan')">Makan Berat</button>
    <button class="tab-btn" onclick="openT(event, 'cemil')">Cemal-Cemil</button>
    <button class="tab-btn" onclick="openT(event, 'black')">Black</button>
    <button class="tab-btn" onclick="openT(event, 'white')">White</button>
    <button class="tab-btn" onclick="openT(event, 'comfy')">Comfy</button>
    <button class="tab-btn" onclick="openT(event, 'refresh')">Refreshing</button>
    <button class="tab-btn" onclick="openT(event, 'alcs')">Alcs</button>
</div>

<div id="swipe-area">
    <div id="no-results" style="display:none; text-align:center; opacity:0.5; margin-top:50px; font-weight:bold;">MENU TIDAK DITEMUKAN</div>

    <div id="makan" class="content active">
        <div class="menu-card" onclick="addToCart('Kalter', 20000)" data-name="Kalter" data-price="20000" data-tags="nasi tahu telor rice tofu egg telur vegetarian kalter">
            <div class="card-img-box"><img src="img/kalter.webp" alt="Kalter"></div>
            <div class="card-info">
                <div class="card-title">Kalter</div>
                <div class="price-btn">20K <span class="plus">+</span></div>
            </div>
        </div>
        <div class="menu-card" onclick="addToCart('Obama', 25000)" data-name="Obama" data-price="25000" data-tags="nasi ayam geprek sambal matah rice chicken pedas spicy hot chili obama">
            <div class="card-img-box"><img src="img/obama.webp" alt="Obama"></div>
            <div class="card-info"><div class="card-title">Obama</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Mangku Koe', 28000)" data-name="Mangku Koe" data-price="28000" data-tags="nasi chicken katsu kari rice ayam curry japanese food mangku koe">
            <div class="card-img-box"><img src="img/mangkukoe.webp" alt="Mangku Koe"></div>
            <div class="card-info"><div class="card-title">Mangku Koe</div><div class="price-btn">28K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Mangku Ayang', 25000)" data-name="Mangku Ayang" data-price="25000" data-tags="nasi ayam siram rice chicken gravy sauce mangku ayang">
            <div class="card-img-box"><img src="img/mangkuayang.webp" alt="Mangku Ayang"></div>
            <div class="card-info"><div class="card-title">Mangku Ayang</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Barudak', 20000)" data-name="Barudak" data-price="20000" data-tags="bakmie katsu sambal matah mie noodle noodles ayam chicken pedas spicy hot barudak">
            <div class="card-img-box"><img src="img/barudak.webp" alt="Barudak"></div>
            <div class="card-info"><div class="card-title">Barudak</div><div class="price-btn">20K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Sekena Gomes', 22000)" data-name="Sekena Gomes" data-price="22000" data-tags="nasgor merah katsu sambal matah nasi goreng fried rice red ayam chicken pedas spicy hot sekena gomes">
            <div class="card-img-box"><img src="img/sekenagomes.webp" alt="Sekena Gomes"></div>
            <div class="card-info"><div class="card-title">Sekena Gomes</div><div class="price-btn">22K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Sekena Goput', 22000)" data-name="Sekena Goput" data-price="22000" data-tags="nasgor putih katsu sambal matah nasi goreng fried rice white ayam chicken pedas spicy hot sekena goput">
            <div class="card-img-box"><img src="img/sekenagoput.webp" alt="Sekena Goput"></div>
            <div class="card-info"><div class="card-title">Sekena Goput</div><div class="price-btn">22K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Sekena Keren', 25000)" data-name="Sekena Keren" data-price="25000" data-tags="nasgor kari katsu sambal matah nasi goreng fried rice curry ayam chicken pedas spicy hot sekena keren">
            <div class="card-img-box"><img src="img/sekenakeren.webp" alt="Sekena Keren"></div>
            <div class="card-info"><div class="card-title">Sekena Keren</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
    </div>

    <div id="cemil" class="content">
        <div class="menu-card best-rec" onclick="addToCart('Paket Sambat', 35000)" data-name="Paket Sambat" data-price="35000" data-tags="aneka camilan snack platter sosis sausage kentang fries gorengan paket sambat">
            <div class="card-img-box"><img src="img/paketsambat.webp" alt="Paket Sambat"></div>
            <div class="card-info"><div class="card-title">Paket Sambat</div><div class="price-btn">35K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Cricket', 25000)" data-name="Cricket" data-price="25000" data-tags="chicken fillet lava ayam boneless pedas spicy hot snack cricket">
            <div class="card-img-box"><img src="img/cricket.webp" alt="Cricket"></div>
            <div class="card-info"><div class="card-title">Cricket</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Potato Freak', 17000)" data-name="Potato Freak" data-price="17000" data-tags="french fries kentang goreng potato chips asin salty snack potato freak">
            <div class="card-img-box"><img src="img/potatofreak.webp" alt="Potato Freak"></div>
            <div class="card-info"><div class="card-title">Potato Freak</div><div class="price-btn">17K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Uhat Lawik', 17000)" data-name="Uhat Lawik" data-price="17000" data-tags="tahu walik tofu aci goreng crispy snack uhat lawik">
            <div class="card-img-box"><img src="img/uhatlawik.webp" alt="Uhat Lawik"></div>
            <div class="card-info"><div class="card-title">Uhat Lawik</div><div class="price-btn">17K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Gyozable', 18000)" data-name="Gyozable" data-price="18000" data-tags="gyoza dimsum dumpling ayam chicken kukus steam goreng fried gyozable">
            <div class="card-img-box"><img src="img/gyozable.webp" alt="Gyozable"></div>
            <div class="card-info"><div class="card-title">Gyozable</div><div class="price-btn">18K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Tahu Julit', 19000)" data-name="Tahu Julit" data-price="19000" data-tags="tahu cabe garam tofu chili salt pedas spicy hot asin snack tahu julit">
            <div class="card-img-box"><img src="img/tahujulit.webp" alt="Tahu Julit"></div>
            <div class="card-info"><div class="card-title">Tahu Julit</div><div class="price-btn">19K <span class="plus">+</span></div></div>
        </div>
    </div>

    <div id="black" class="content">
        <div class="menu-card best-rec" onclick="addToCart('Fressa', 25000)" data-name="Fressa" data-price="25000" data-tags="berry soda coffee kopi buah segar fizz fressa">
            <div class="card-img-box"><img src="img/fressa.webp" alt="Fressa"></div>
            <div class="card-info"><div class="card-title">Fressa</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Americano', 16000)" data-name="Americano" data-price="16000" data-tags="americano kopi hitam black coffee pahit bitter no sugar">
            <div class="card-img-box"><img src="img/americano.webp" alt="Americano"></div>
            <div class="card-info"><div class="card-title">Americano</div><div class="price-btn">16K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Dark Freshly', 19000)" data-name="Dark Freshly" data-price="19000" data-tags="americano lemon kopi coffee citrus segar fresh dark freshly">
            <div class="card-img-box"><img src="img/darkfreshly.webp" alt="Dark Freshly"></div>
            <div class="card-info"><div class="card-title">Dark Freshly</div><div class="price-btn">19K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Darkberry', 19000)" data-name="Darkberry" data-price="19000" data-tags="americano berry kopi coffee strawberry fruity darkberry">
            <div class="card-img-box"><img src="img/darkberry.webp" alt="Darkberry"></div>
            <div class="card-info"><div class="card-title">Darkberry</div><div class="price-btn">19K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Tubruk Syari', 13000)" data-name="Tubruk Syari" data-price="13000" data-tags="kopi tubruk traditional black coffee ampas tubruk syari">
            <div class="card-img-box"><img src="img/tubruksyari.webp" alt="Tubruk Syari"></div>
            <div class="card-info"><div class="card-title">Tubruk Syari</div><div class="price-btn">13K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Hanoi Tears', 15000)" data-name="Hanoi Tears" data-price="15000" data-tags="vietnam drip kopi susu milk condensed manis sweet hanoi tears">
            <div class="card-img-box"><img src="img/hanoitears.webp" alt="Hanoi Tears"></div>
            <div class="card-info"><div class="card-title">Hanoi Tears</div><div class="price-btn">15K <span class="plus">+</span></div></div>
        </div>
    </div>

    <div id="white" class="content">
        <div class="menu-card best-rec" onclick="addToCart('Penkopi', 23000)" data-name="Penkopi" data-price="23000" data-tags="creamy coffee kopi susu milk latte palm sugar gula aren penkopi">
            <div class="card-img-box"><img src="img/penkopi.webp" alt="Penkopi"></div>
            <div class="card-info"><div class="card-title">Penkopi</div><div class="price-btn">23K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Macch Favorito', 20000)" data-name="Macch Favorito" data-price="20000" data-tags="caramel macchiato kopi coffee susu milk karamel manis sweet macch favorito">
            <div class="card-img-box"><img src="img/macchfavorito.webp" alt="Macch Favorito"></div>
            <div class="card-info"><div class="card-title">Macch Favorito</div><div class="price-btn">20K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Specta', 25000)" data-name="Specta" data-price="25000" data-tags="peanut coffee kopi kacang skippy jam susu milk specta">
            <div class="card-img-box"><img src="img/specta.webp" alt="Specta"></div>
            <div class="card-info"><div class="card-title">Specta</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Comica', 22000)" data-name="Comica" data-price="22000" data-tags="hazelnut coffee kopi susu milk kacang wangi comica">
            <div class="card-img-box"><img src="img/comica.webp" alt="Comica"></div>
            <div class="card-info"><div class="card-title">Comica</div><div class="price-btn">22K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Rhumpee', 20000)" data-name="Rhumpee" data-price="20000" data-tags="rhum coffee rum non alkohol kopi susu milk wangi rhumpee">
            <div class="card-img-box"><img src="img/rhumpee.webp" alt="Rhumpee"></div>
            <div class="card-info"><div class="card-title">Rhumpee</div><div class="price-btn">20K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Crush', 22000)" data-name="Crush" data-price="22000" data-tags="rhum regal coffee rum biskuit biscuit marie susu milk crush">
            <div class="card-img-box"><img src="img/crush.webp" alt="Crush"></div>
            <div class="card-info"><div class="card-title">Crush</div><div class="price-btn">22K <span class="plus">+</span></div></div>
        </div>
    </div>

    <div id="comfy" class="content">
        <div class="menu-card best-rec" onclick="addToCart('Mammy', 18000)" data-name="Mammy" data-price="18000" data-tags="matcha latte green tea teh hijau susu milk japanese mammy">
            <div class="card-img-box"><img src="img/mammy.webp" alt="Mammy"></div>
            <div class="card-info"><div class="card-title">Mammy</div><div class="price-btn">18K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Deep Choc', 18000)" data-name="Deep Choc" data-price="18000" data-tags="chocolate coklat cocoa susu milk manis sweet deep choc">
            <div class="card-img-box"><img src="img/deepchoc.webp" alt="Deep Choc"></div>
            <div class="card-info"><div class="card-title">Deep Choc</div><div class="price-btn">18K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Schopea', 25000)" data-name="Schopea" data-price="25000" data-tags="peanut chocolate coklat kacang susu milk schopea">
            <div class="card-img-box"><img src="img/schopea.webp" alt="Schopea"></div>
            <div class="card-info"><div class="card-title">Schopea</div><div class="price-btn">25K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Creamberry', 23000)" data-name="Creamberry" data-price="23000" data-tags="berry latte strawberry susu milk fruity creamberry">
            <div class="card-img-box"><img src="img/creamberry.webp" alt="Creamberry"></div>
            <div class="card-info"><div class="card-title">Creamberry</div><div class="price-btn">23K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Jandu', 18000)" data-name="Jandu" data-price="18000" data-tags="jahe madu ginger honey hangat warm herbal wedang jandu">
            <div class="card-img-box"><img src="img/jandu.webp" alt="Jandu"></div>
            <div class="card-info"><div class="card-title">Jandu</div><div class="price-btn">18K <span class="plus">+</span></div></div>
        </div>
    </div>

    <div id="refresh" class="content">
        <div class="menu-card" onclick="addToCart('Threepi', 15000)" data-name="Threepi" data-price="15000" data-tags="tropical tea teh buah fruit segar fresh threepi">
            <div class="card-img-box"><img src="img/threepi.webp" alt="Threepi"></div>
            <div class="card-info"><div class="card-title">Threepi</div><div class="price-btn">15K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Teh Gelies', 10000)" data-name="Teh Gelies" data-price="10000" data-tags="jasmine tea teh melati manis sweet es ice teh gelies">
            <div class="card-img-box"><img src="img/tehgelies.webp" alt="Teh Gelies"></div>
            <div class="card-info"><div class="card-title">Teh Gelies</div><div class="price-btn">10K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card best-rec" onclick="addToCart('Red Bloom', 18000)" data-name="Red Bloom" data-price="18000" data-tags="yakult berry yogurt strawberry probiotik asam manis sour sweet red bloom">
            <div class="card-img-box"><img src="img/redbloom.webp" alt="Red Bloom"></div>
            <div class="card-info"><div class="card-title">Red Bloom</div><div class="price-btn">18K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Yagustea', 15000)" data-name="Yagustea" data-price="15000" data-tags="yakult sugus grape anggur permen candy ungu purple yagustea">
            <div class="card-img-box"><img src="img/yagustea.webp" alt="Yagustea"></div>
            <div class="card-info"><div class="card-title">Yagustea</div><div class="price-btn">15K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Chenteal', 15000)" data-name="Chenteal" data-price="15000" data-tags="yakult lychee tea leci teh fruit chenteal">
            <div class="card-img-box"><img src="img/chenteal.webp" alt="Chenteal"></div>
            <div class="card-info"><div class="card-title">Chenteal</div><div class="price-btn">15K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Trustey', 18000)" data-name="Trustey" data-price="18000" data-tags="honey yuzu madu jeruk citrus orange lemon segar trustey">
            <div class="card-img-box"><img src="img/trustey.webp" alt="Trustey"></div>
            <div class="card-info"><div class="card-title">Trustey</div><div class="price-btn">18K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Rindu', 15000)" data-name="Rindu" data-price="15000" data-tags="winter melon kundur buah manis segar rindu">
            <div class="card-img-box"><img src="img/rindu.webp" alt="Rindu"></div>
            <div class="card-info"><div class="card-title">Rindu</div><div class="price-btn">15K <span class="plus">+</span></div></div>
        </div>
        <div class="menu-card" onclick="addToCart('Literally Water', 5000)" data-name="Literally Water" data-price="5000" data-tags="air mineral water bening tawar literally water">
             <div class="card-img-box"><img src="img/literallywater.webp" alt="Literally Water"></div>
             <div class="card-info"><div class="card-title">Literally Water</div><div class="price-btn">5K <span class="plus">+</span></div></div>
        </div>
    </div>

    <div id="alcs" class="content">
        <div class="alcs-card" data-tags="bintang beer bir pilsener alkohol alcohol">
            <div class="alcs-brand">BINTANG</div>
            <div class="alcs-list">
                <div class="alcs-row" onclick="addToCart('Bintang Small', 32000)"><span class="alcs-variant">Small</span><span class="alcs-price-tag">32K +</span></div>
                <div class="alcs-row" onclick="addToCart('Bintang Radler', 32000)"><span class="alcs-variant">Radler</span><span class="alcs-price-tag">32K +</span></div>
                <div class="alcs-row" onclick="addToCart('Bintang Large', 50000)"><span class="alcs-variant">Large</span><span class="alcs-price-tag">50K +</span></div>
            </div>
        </div>
        <div class="alcs-card" data-tags="anker beer bir lychee leci pineapple nanas alkohol alcohol">
            <div class="alcs-brand">ANKER</div>
            <div class="alcs-list">
                <div class="alcs-row" onclick="addToCart('Anker Lychee', 29000)"><span class="alcs-variant">Lychee</span><span class="alcs-price-tag">29K +</span></div>
                <div class="alcs-row" onclick="addToCart('Anker Pineapple', 29000)"><span class="alcs-variant">Pineapple</span><span class="alcs-price-tag">29K +</span></div>
            </div>
        </div>
        <div class="alcs-card" data-tags="smirnoff vodka raspberry berry green apple apel hijau lemon lychee leci pink lemonade alkohol alcohol">
            <div class="alcs-brand">SMIRNOFF</div>
            <div class="alcs-list">
                <div class="alcs-row" onclick="addToCart('Smirnoff Raspberry', 33000)"><span class="alcs-variant">Raspberry</span><span class="alcs-price-tag">33K +</span></div>
                <div class="alcs-row" onclick="addToCart('Smirnoff Green Apple', 33000)"><span class="alcs-variant">Green Apple</span><span class="alcs-price-tag">33K +</span></div>
                <div class="alcs-row" onclick="addToCart('Smirnoff Lemon Lyc', 33000)"><span class="alcs-variant">Lemon Lychee</span><span class="alcs-price-tag">33K +</span></div>
                <div class="alcs-row" onclick="addToCart('Smirnoff Pink Lem', 33000)"><span class="alcs-variant">Pink Lemonade</span><span class="alcs-price-tag">33K +</span></div>
            </div>
        </div>
        <div class="alcs-card" data-tags="mix max vodka anggur merah red grape exotic blue biru alkohol alcohol">
            <div class="alcs-brand">MIX MAX</div>
            <div class="alcs-list">
                <div class="alcs-row" onclick="addToCart('Mix Max Anggur', 34000)"><span class="alcs-variant">Anggur Merah</span><span class="alcs-price-tag">34K +</span></div>
                <div class="alcs-row" onclick="addToCart('Mix Max Blue', 34000)"><span class="alcs-variant">Exotic Blue</span><span class="alcs-price-tag">34K +</span></div>
            </div>
        </div>
        <div class="alcs-card" data-tags="iceland vodka lychee leci long island alkohol alcohol">
            <div class="alcs-brand">ICELAND</div>
            <div class="alcs-list">
                <div class="alcs-row" onclick="addToCart('Iceland Lychee', 34000)"><span class="alcs-variant">Lychee</span><span class="alcs-price-tag">34K +</span></div>
                <div class="alcs-row" onclick="addToCart('Iceland L. Island', 34000)"><span class="alcs-variant">Long Island</span><span class="alcs-price-tag">34K +</span></div>
            </div>
        </div>
        <div class="alcs-card" data-tags="api anggur hijau green grape kawa kawi arak bali alkohol alcohol">
            <div class="alcs-brand">API</div>
            <div class="alcs-list">
                <div class="alcs-row" onclick="addToCart('Api Anggur Hijau', 106000)"><span class="alcs-variant">Anggur Hijau</span><span class="alcs-price-tag">106K +</span></div>
            </div>
        </div>
    </div>
</div>

<div id="cart-modal" class="modal">
    <div class="modal-content">
        <div class="close-modal" onclick="closeCart()">&times;</div>
        <div class="modal-header" style="font-weight:900; font-size:20px; text-align:center; margin-bottom:20px;">PESANANMU</div>
        <div id="cart-items-container"></div>
        
        <div class="total-row">
            <span>TOTAL</span>
            <span id="modal-total">Rp 0</span>
        </div>
        
        <div class="input-group">
            <label>Nomor Meja*</label>
            <input type="number" id="table-number" placeholder="Scan QR Meja..." required inputmode="numeric">
        </div>
        <div class="input-group">
            <label>Nama Kakak*</label>
            <input type="text" id="customer-real-name" placeholder="Siapa nama kakak?" required>
        </div>
        
        <div class="input-group">
            <label>Metode Pembayaran*</label>
            <div class="payment-options">
                <label class="p-option">
                    <input type="radio" name="payment_method" value="tunai" checked>
                    <div class="p-label">
                        <span>üíµ</span> TUNAI (Kasir)
                    </div>
                </label>
                <label class="p-option">
                    <input type="radio" name="payment_method" value="qris">
                    <div class="p-label">
                        <span>üì±</span> QRIS / E-Wallet
                    </div>
                </label>
            </div>
        </div>
        
        <div class="input-group">
            <label>Nomor HP / WA (Opsional)</label>
            <input type="tel" id="customer-phone" placeholder="08xxxxxxxxxx" inputmode="tel">
        </div>

        <button class="btn-order" onclick="submitOrder()">KIRIM KE DAPUR</button>
    </div>
</div>

<div id="success-modal" class="modal">
    <div class="modal-content">
        <div class="success-icon">‚úî</div>
        <div class="modal-header" style="border:none; margin-bottom:5px; text-align:center;">BERHASIL!</div>
        <div class="success-msg">
            Pesanan Kakak sudah kami terima.<br>
            <b>Mohon segera selesaikan pembayaran</b> agar pesanan bisa diproses.
        </div>
        <button class="btn-close-final" onclick="closeSuccess()">OK, MENGERTI</button>
    </div>
</div>

<div id="history-modal" class="modal">
    <div class="modal-content">
        <div class="close-modal" onclick="closeHistory()">&times;</div>
        <div class="modal-header" style="text-align:center; margin-bottom:15px; font-weight:900;">RIWAYAT PESANAN</div>
        <div id="history-container" style="padding-bottom:10px;"></div>
        <button class="btn-close-final" onclick="closeHistory()">TUTUP</button>
    </div>
</div>

<div id="clear-history-modal" class="modal">
    <div class="modal-content" style="text-align:center;">
        <div class="success-icon" style="color:red; font-size:50px; margin-bottom:10px;">üóë</div>
        <div class="modal-header" style="border:none; margin-bottom:10px; text-align:center; color:#1A1A1A;">HAPUS RIWAYAT?</div>
        <div class="success-msg" style="margin-bottom:20px; font-size:14px; color:#555;">
            Semua riwayat pesanan yang <b>SUDAH SELESAI</b> akan dihapus permanen dari memori HP ini.
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:10px;">
            <button onclick="closeClearHistoryModal()" 
                    style="background:#eee; color:#333; border:none; padding:12px; border-radius:10px; font-weight:bold; cursor:pointer;">
                BATAL
            </button>
            <button onclick="executeClearHistory()" 
                    style="background:red; color:#fff; border:none; padding:12px; border-radius:10px; font-weight:bold; cursor:pointer;">
                YA, HAPUS
            </button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    // --- KONFIGURASI FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyBSp5184dVTy-EER2qOfxeEA9KQOCMFpKo",
        authDomain: "sbs-menu-d1611.firebaseapp.com",
        databaseURL: "https://sbs-menu-d1611-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "sbs-menu-d1611",
        storageBucket: "sbs-menu-d1611.firebasestorage.app",
        messagingSenderId: "530098727952",
        appId: "1:530098727952:web:1bb3072d93be9564fbee95"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // --- LOGIC CART ---
    let cart = JSON.parse(localStorage.getItem('sbs_cart')) || [];

    // FUNGSI CEK URL (?table=5)
    function getTableFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('table');
    }

    // SAAT PAGE LOAD
    window.onload = function() {
        const tableFromURL = getTableFromURL();
        const tableInput = document.getElementById('table-number');
        
        if (tableFromURL) {
            tableInput.value = tableFromURL;
            tableInput.readOnly = true;
            tableInput.style.backgroundColor = "#eee"; 
            tableInput.placeholder = "Meja " + tableFromURL;
        } else {
            tableInput.readOnly = false;
            tableInput.style.backgroundColor = "#fff";
            tableInput.placeholder = "Ketik Nomor Meja...";
        }

        checkPendingQRIS();
        updateCartUI();
        trackOrders();
    };

    function addToCart(name, price) {
        const existingItem = cart.find(item => item.name === name);
        if (existingItem) {
            existingItem.qty++;
        } else {
            cart.push({ name: name, price: price, qty: 1, note: '' });
        }
        updateCartUI();
        localStorage.setItem('sbs_cart', JSON.stringify(cart));
        if (navigator.vibrate) navigator.vibrate(50);
    }

    function updateCartUI() {
        let totalQty = 0;
        cart.forEach(item => totalQty += item.qty);

        const fabCart = document.getElementById('fab-cart');
        const badgeCart = document.getElementById('badge-cart');

        if (totalQty > 0) {
            fabCart.classList.add('has-items');
            badgeCart.innerText = totalQty;
            badgeCart.classList.add('show');
            if (navigator.vibrate) navigator.vibrate(50); 
        } else {
            fabCart.classList.remove('has-items');
            badgeCart.classList.remove('show');
        }
    }

    function openCart() {
        renderCart();
        document.getElementById('cart-modal').style.display = 'flex';
        document.body.classList.add('noscroll');
    }

    function closeCart() {
        document.getElementById('cart-modal').style.display = 'none';
        document.body.classList.remove('noscroll');
    }

    function renderCart() {
        const container = document.getElementById('cart-items-container');
        container.innerHTML = '';
        let total = 0;

        if (cart.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#888; padding:20px;">Keranjang Masih Kosong</div>';
            document.getElementById('modal-total').innerText = 'Rp 0';
            return;
        }

        cart.forEach((item, index) => {
            total += item.price * item.qty;
            let priceDetail = '';
            if (item.qty > 1) {
                priceDetail = `<div style="font-size:11px; color:#888; margin-top:2px; font-weight:normal;">(${item.qty} x Rp ${item.price.toLocaleString('id-ID')})</div>`;
            }

            container.innerHTML += `
                <div class="cart-item">
                    <div class="item-main">
                        <div>
                            <span>${item.qty}x ${item.name}</span>
                            ${priceDetail} </div>
                        <span>Rp ${(item.price * item.qty).toLocaleString('id-ID')}</span>
                    </div>
                    <input type="text" class="item-note-input" placeholder="Catatan (cth: Pedas, Tanpa Es)..." 
                           value="${item.note || ''}" onchange="updateItemNote(${index}, this.value)">
                    <div class="cart-actions" style="text-align:right; margin-top:5px;">
                        <button onclick="changeQty(${index}, -1)" style="background:#ddd; width:30px; border:none; border-radius:5px;">-</button>
                        <button onclick="changeQty(${index}, 1)" style="background:#FFD200; width:30px; border:none; border-radius:5px;">+</button>
                    </div>
                </div>`;
        });
        document.getElementById('modal-total').innerText = 'Rp ' + total.toLocaleString('id-ID');
    }

    function changeQty(index, delta) {
        cart[index].qty += delta;
        if (cart[index].qty <= 0) {
            cart.splice(index, 1);
        }
        updateCartUI();
        renderCart();
        localStorage.setItem('sbs_cart', JSON.stringify(cart));
        if (cart.length === 0) closeCart();
    }

    function updateItemNote(index, value) {
        cart[index].note = value;
    }
    
    function submitOrder() {
        const tableNum = document.getElementById('table-number').value;
        const custName = document.getElementById('customer-real-name').value;
        const custPhone = document.getElementById('customer-phone').value;
        const paymentRadio = document.querySelector('input[name="payment_method"]:checked');
        const paymentMethod = paymentRadio ? paymentRadio.value : 'tunai';

        if (!tableNum) { alert("Mohon isi Nomor Meja!"); return; }
        if (!custName) { alert("Mohon isi Nama Kakak!"); return; }
        if (cart.length === 0) return;

        let totalPrice = 0;
        cart.forEach(item => totalPrice += (item.price * item.qty));

        let initialStatus = (paymentMethod === 'tunai') ? 'new' : 'qris_unpaid';

        const orderData = {
            tableNumber: tableNum,
            customerName: custName,
            customerPhone: custPhone,
            paymentMethod: paymentMethod,
            items: cart,
            total: totalPrice,
            timestamp: new Date().toISOString(),
            status: initialStatus,
            clientPaidAt: null
        };

        const newOrderRef = db.ref().child('orders').push();
        newOrderRef.set(orderData)
        .then(() => {
            saveOrderToHistory(newOrderRef.key);
            
            if(paymentMethod === 'qris') {
                localStorage.setItem('sbs_pending_qris', JSON.stringify({
                    id: newOrderRef.key,
                    amount: totalPrice
                }));
            }
            
            cart = []; 
            localStorage.removeItem('sbs_cart');
            updateCartUI();
            closeCart();
            
            if(!document.getElementById('table-number').readOnly) {
                document.getElementById('table-number').value = '';
            }
            document.getElementById('customer-real-name').value = '';
            
            if(paymentMethod === 'qris') {
                showQRISModal(totalPrice, newOrderRef.key);
            } else {
                showSuccessModal();
            }
        })
        .catch((error) => {
            alert("Gagal mengirim: " + error.message);
        });
    }

    function checkPendingQRIS() {
        const pending = JSON.parse(localStorage.getItem('sbs_pending_qris'));
        if (pending) {
            db.ref('orders/' + pending.id).once('value').then(snapshot => {
                const data = snapshot.val();
                if (data && data.status === 'qris_unpaid') {
                    showQRISModal(pending.amount, pending.id);
                } else {
                    localStorage.removeItem('sbs_pending_qris');
                }
            });
        }
    }

    function showQRISModal(amount, orderId) {
        const modal = document.getElementById('success-modal');
        modal.querySelector('.modal-content').innerHTML = `
            <div class="modal-header" style="border:none; text-align:center; font-size:24px;">SCAN QRIS</div>
            <div style="text-align:center; margin-bottom:15px;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg" 
                     alt="QRIS Code" style="width:200px; height:200px; border:2px solid #000; padding:5px;">
                <br>
                <div style="font-weight:bold; font-size:18px; margin-top:10px;">Rp ${amount.toLocaleString('id-ID')}</div>
            </div>
            <div class="success-msg" style="font-size:12px;">
                1. Scan QR di atas.<br>
                2. Tekan tombol di bawah <b>SETELAH</b> transfer berhasil.<br>
                3. Pesanan baru akan masuk ke Dapur setelah konfirmasi.
            </div>
            <button class="btn-close-final" onclick="confirmQRISPayment('${orderId}')">SAYA SUDAH BAYAR</button>
        `;
        modal.style.display = 'flex';
    }

    function confirmQRISPayment(orderId) {
        db.ref('orders/' + orderId).update({
            status: 'pending_payment',
            clientPaidAt: new Date().toISOString()
        }).then(() => {
            localStorage.removeItem('sbs_pending_qris');
            const modal = document.getElementById('success-modal');
            modal.querySelector('.modal-content').innerHTML = `
                <div class="success-icon">‚è≥</div>
                <div class="modal-header" style="border:none; margin-bottom:5px; text-align:center;">PEMBAYARAN DITERIMA</div>
                <div class="success-msg">
                    Terima kasih! Bukti bayar sudah masuk.<br>
                    Dapur sedang memverifikasi pesananmu.
                </div>
                <button class="btn-close-final" onclick="closeSuccess()">OK, MENGERTI</button>
            `;
            modal.style.display = 'flex'; 
        }).catch(err => {
            alert("Error: " + err.message);
        });
    }
    function showSuccessModal() {
        const modal = document.getElementById('success-modal');
        modal.querySelector('.modal-content').innerHTML = `
            <div class="success-icon">‚úî</div>
            <div class="modal-header" style="border:none; margin-bottom:5px; text-align:center;">PESANAN DITERIMA!</div>
            <div class="success-msg">
                Mohon lakukan pembayaran di <b>KASIR</b><br>
                agar pesanan segera diproses.
            </div>
            <button class="btn-close-final" onclick="closeSuccess()">OK, MENGERTI</button>
        `;
        modal.style.display = 'flex';
    }

    function closeSuccess() {
        document.getElementById('success-modal').style.display = 'none';
    }

    const AUTO_CLEAR_TIME = 6 * 60 * 60 * 1000; 

    function saveOrderToHistory(orderId) {
        let history = JSON.parse(localStorage.getItem('sbs_order_history')) || [];
        if (!history.includes(orderId)) {
            history.push(orderId);
            localStorage.setItem('sbs_order_history', JSON.stringify(history));
        }
        trackOrders();
    }

    function trackOrders() {
        let history = JSON.parse(localStorage.getItem('sbs_order_history')) || [];
        const fabHistory = document.getElementById('fab-history');
        const badgeHistory = document.getElementById('badge-history');
        const container = document.getElementById('history-container');
        
        if (history.length === 0) {
            fabHistory.style.display = 'none';
            container.innerHTML = '<div style="text-align:center;color:#888;padding:20px;">Belum ada riwayat pesanan</div>';
            return;
        }

        fabHistory.style.display = 'flex';
        container.innerHTML = `
            <div id="active-orders-section" style="display:none;">
                <div class="history-section-title" style="color:var(--sbs-orange)">SEDANG BERJALAN</div>
                <div id="list-active"></div>
            </div>
            <div id="past-orders-section" style="display:none;">
                <div class="history-section-title" style="color:#888">RIWAYAT SELESAI</div>
                <div id="list-past"></div>
                <button class="btn-clear-history" onclick="manualClearHistory()">Hapus Semua Riwayat</button>
            </div>
        `;

        const listActive = document.getElementById('list-active');
        const listPast = document.getElementById('list-past');
        let activeCount = 0;
        let pastCount = 0;
        const now = Date.now();

        history.forEach(orderId => {
            db.ref('orders/' + orderId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;

                if (['completed', 'rejected'].includes(data.status)) {
                    const orderTime = new Date(data.completedAt || data.timestamp).getTime();
                    if (now - orderTime > AUTO_CLEAR_TIME) return;
                }

                let statusText = 'MENUNGGU';
                let color = '#888';
                let isActive = false;

                if(data.status === 'new') { statusText = 'MENUNGGU KONFIRMASI'; color = '#888'; isActive = true; }
                else if(data.status === 'qris_unpaid') { statusText = 'MENUNGGU PEMBAYARAN'; color = '#e67e22'; isActive = true; }
                else if(data.status === 'pending_payment') { statusText = 'VERIFIKASI PEMBAYARAN'; color = '#e67e22'; isActive = true; }
                else if(data.status === 'unpaid') { statusText = 'DIPROSES'; color = '#FF6600'; isActive = true; }
                else if(data.status === 'processing') { statusText = 'SEDANG DISIAPKAN'; color = '#3498db'; isActive = true; }
                else if(data.status === 'completed') { statusText = 'SELESAI'; color = '#2ecc71'; isActive = false; }
                else if(data.status === 'rejected') { statusText = 'DITOLAK / BATAL'; color = 'red'; isActive = false; }

                if(document.getElementById('card-'+orderId)) return;

                // ITEM LIST DETAIL (Request 3)
                let itemRows = '';
                (data.items || []).forEach(i => {
                    itemRows += `<div class="h-item"><span class="h-item-name">${i.qty}x ${i.name}</span><span class="h-item-price">${(i.qty * i.price).toLocaleString()}</span></div>`;
                });

                // TOTAL CALCULATION (Termasuk Pajak/Diskon jika ada di finalData)
                let finalTotal = data.total;
                if(data.finalData && data.finalData.finalTotal) finalTotal = data.finalData.finalTotal;

                const html = `
                    <div id="card-${orderId}" class="history-card" style="border-left:4px solid ${color}">
                        <div class="h-header">
                            <span class="h-status" style="background:${color}; color:#fff;">${statusText}</span>
                            <span class="h-id">#${orderId.slice(-4)}</span>
                        </div>
                        <div style="margin-bottom:8px;">${itemRows}</div>
                        <div class="h-total">
                            <span>TOTAL</span>
                            <span>Rp ${parseInt(finalTotal).toLocaleString('id-ID')}</span>
                        </div>
                    </div>
                `;

                if (isActive) {
                    listActive.insertAdjacentHTML('beforeend', html);
                    activeCount++;
                    document.getElementById('active-orders-section').style.display = 'block';
                } else {
                    listPast.insertAdjacentHTML('beforeend', html);
                    pastCount++;
                    document.getElementById('past-orders-section').style.display = 'block';
                }

                if (activeCount > 0) {
                    fabHistory.classList.add('active-order');
                    badgeHistory.innerText = activeCount;
                    badgeHistory.classList.add('show');
                } else {
                    fabHistory.classList.remove('active-order');
                    badgeHistory.classList.remove('show');
                }
                
                if(activeCount === 0 && pastCount === 0) fabHistory.style.display = 'none';
            });
        });
    }

    function manualClearHistory() {
        document.getElementById('clear-history-modal').style.display = 'flex';
    }

    function closeClearHistoryModal() {
        document.getElementById('clear-history-modal').style.display = 'none';
    }

    function executeClearHistory() {
        localStorage.removeItem('sbs_order_history');
        location.reload(); 
    }

    function openHistory() { 
        trackOrders();
        document.getElementById('history-modal').style.display = 'flex'; 
        document.body.classList.add('noscroll'); 
    }
    
    function closeHistory() { 
        document.getElementById('history-modal').style.display = 'none'; 
        document.body.classList.remove('noscroll'); 
    }

    // --- TAB & SWIPE & SEARCH LOGIC ---
    function openT(e, n) {
        const searchInput = document.getElementById('menuSearch');
        if(searchInput && searchInput.value !== '') { clearSearchInput(); }
        var i, c, t;
        c = document.getElementsByClassName("content");
        for (i = 0; i < c.length; i++) c[i].classList.remove("active");
        t = document.getElementsByClassName("tab-btn");
        for (i = 0; i < t.length; i++) t[i].classList.remove("active");
        document.getElementById(n).classList.add("active");
        if(e && e.currentTarget) {
            e.currentTarget.classList.add("active");
            e.currentTarget.scrollIntoView({behavior: 'smooth', inline: 'center', block: 'nearest'});
        }
    }

    const swipeArea = document.getElementById('swipe-area');
    let startX = 0; let startY = 0; let endX = 0; let endY = 0;
    const minSwipeDistance = 70; 

    swipeArea.addEventListener('touchstart', (e) => {
        if(document.body.classList.contains('search-mode-active')) return;
        startX = e.changedTouches[0].screenX;
        startY = e.changedTouches[0].screenY; 
    }, {passive: true});

    swipeArea.addEventListener('touchend', (e) => {
        if(document.body.classList.contains('search-mode-active')) return;
        endX = e.changedTouches[0].screenX;
        endY = e.changedTouches[0].screenY; 
        handleSwipeGesture();
    }, {passive: true});

    function handleSwipeGesture() {
        const distanceX = endX - startX;
        const distanceY = endY - startY;
        if (Math.abs(distanceX) > minSwipeDistance && Math.abs(distanceX) > Math.abs(distanceY)) {
            const tabs = Array.from(document.querySelectorAll('.tab-btn'));
            const activeTab = document.querySelector('.tab-btn.active');
            const currentIndex = tabs.indexOf(activeTab);
            if (distanceX < 0) { if (currentIndex < tabs.length - 1) tabs[currentIndex + 1].click(); } 
            else { if (currentIndex > 0) tabs[currentIndex - 1].click(); }
        }
    }

    const searchInput = document.getElementById('menuSearch');
    const clearBtn = document.getElementById('clearSearch');
    const menuTabs = document.getElementById('menuTabs');
    const noResults = document.getElementById('no-results');
    const categoryMap = { 'kopi': ['black', 'white'], 'coffee': ['black', 'white'], 'alkohol': ['alcs'], 'beer': ['alcs'] };

    if(searchInput) {
        searchInput.addEventListener('keyup', (e) => {
            const term = e.target.value.toLowerCase().trim();
            clearBtn.style.display = term.length > 0 ? 'flex' : 'none';
            if (term.length === 0) { exitSearchMode(); return; }
            enterSearchMode();
            if (categoryMap[term]) { showFullCategories(categoryMap[term]); } else { filterSpecificItems(term); }
        });
    }

    function enterSearchMode() { document.body.classList.add('search-mode-active'); menuTabs.classList.add('hidden-by-search'); }
    function exitSearchMode() {
        document.body.classList.remove('search-mode-active'); menuTabs.classList.remove('hidden-by-search');
        document.querySelectorAll('.menu-card, .alcs-card').forEach(card => card.classList.remove('card-hidden'));
        document.querySelectorAll('.content').forEach(section => section.classList.remove('section-hidden'));
        noResults.style.display = 'none';
        const activeBtn = document.querySelector('.tab-btn.active');
        if(activeBtn) { const tabName = activeBtn.getAttribute('onclick').match(/'([^']+)'/)[1]; var c = document.getElementsByClassName("content"); for (var i = 0; i < c.length; i++) c[i].classList.remove("active"); document.getElementById(tabName).classList.add("active"); }
    }
    function clearSearchInput() { if(searchInput) searchInput.value = ''; if(clearBtn) clearBtn.style.display = 'none'; exitSearchMode(); }
    function showFullCategories(targetIds) { let hasResult = false; document.querySelectorAll('.content').forEach(section => { if (targetIds.includes(section.id)) { section.classList.remove('section-hidden'); section.querySelectorAll('.menu-card, .alcs-card').forEach(c => c.classList.remove('card-hidden')); hasResult = true; } else { section.classList.add('section-hidden'); } }); noResults.style.display = hasResult ? 'none' : 'block'; }
    function filterSpecificItems(term) { let hasResult = false; document.querySelectorAll('.content').forEach(section => { let visibleCardsCount = 0; const cards = section.querySelectorAll('.menu-card, .alcs-card'); cards.forEach(card => { const textContent = card.innerText.toLowerCase(); const imgAlt = card.querySelector('img') ? card.querySelector('img').alt.toLowerCase() : ''; const tags = card.getAttribute('data-tags') ? card.getAttribute('data-tags').toLowerCase() : ''; if (textContent.includes(term) || imgAlt.includes(term) || tags.includes(term)) { card.classList.remove('card-hidden'); visibleCardsCount++; hasResult = true; } else { card.classList.add('card-hidden'); } }); if (visibleCardsCount > 0) { section.classList.remove('section-hidden'); } else { section.classList.add('section-hidden'); } }); noResults.style.display = hasResult ? 'none' : 'block'; }
</script>
</body>
</html>
